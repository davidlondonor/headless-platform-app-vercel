{"version":3,"file":"addIdentifierToLinariaPreval.js","names":["createId","reference","getOrAddLinariaPreval","scope","rootScope","getProgramParent","object","getData","prevalExport","type","expression","operator","left","property","computed","right","properties","programPath","path","inserted","pushContainer","get","setData","addIdentifierToLinariaPreval","name","newProperty","key","value","shorthand"],"sources":["../src/addIdentifierToLinariaPreval.ts"],"sourcesContent":["import type { NodePath, Scope } from '@babel/traverse';\nimport type {\n  ExpressionStatement,\n  Identifier,\n  ObjectExpression,\n  ObjectProperty,\n  Program,\n} from '@babel/types';\n\nimport { createId } from './createId';\nimport { reference } from './scopeHelpers';\n\nfunction getOrAddLinariaPreval(scope: Scope): NodePath<ObjectExpression> {\n  const rootScope = scope.getProgramParent();\n  let object = rootScope.getData('__linariaPreval');\n  if (object) {\n    return object;\n  }\n\n  const prevalExport: ExpressionStatement = {\n    type: 'ExpressionStatement',\n    expression: {\n      type: 'AssignmentExpression',\n      operator: '=',\n      left: {\n        type: 'MemberExpression',\n        object: createId('exports'),\n        property: createId('__linariaPreval'),\n        computed: false,\n      },\n      right: {\n        type: 'ObjectExpression',\n        properties: [],\n      },\n    },\n  };\n\n  const programPath = rootScope.path as NodePath<Program>;\n  const [inserted] = programPath.pushContainer('body', [prevalExport]);\n  object = inserted.get('expression.right') as NodePath<ObjectExpression>;\n  rootScope.setData('__linariaPreval', object);\n  return object;\n}\n\nexport function addIdentifierToLinariaPreval(scope: Scope, name: string) {\n  const rootScope = scope.getProgramParent();\n  const object = getOrAddLinariaPreval(rootScope);\n  const newProperty: ObjectProperty = {\n    type: 'ObjectProperty',\n    key: createId(name),\n    value: createId(name),\n    computed: false,\n    shorthand: false,\n  };\n\n  const [inserted] = object.pushContainer('properties', [newProperty]);\n  reference(inserted.get('value') as NodePath<Identifier>);\n}\n"],"mappings":"AASA,SAASA,QAAQ,QAAQ,YAAY;AACrC,SAASC,SAAS,QAAQ,gBAAgB;AAE1C,SAASC,qBAAqB,CAACC,KAAY,EAA8B;EACvE,MAAMC,SAAS,GAAGD,KAAK,CAACE,gBAAgB,EAAE;EAC1C,IAAIC,MAAM,GAAGF,SAAS,CAACG,OAAO,CAAC,iBAAiB,CAAC;EACjD,IAAID,MAAM,EAAE;IACV,OAAOA,MAAM;EACf;EAEA,MAAME,YAAiC,GAAG;IACxCC,IAAI,EAAE,qBAAqB;IAC3BC,UAAU,EAAE;MACVD,IAAI,EAAE,sBAAsB;MAC5BE,QAAQ,EAAE,GAAG;MACbC,IAAI,EAAE;QACJH,IAAI,EAAE,kBAAkB;QACxBH,MAAM,EAAEN,QAAQ,CAAC,SAAS,CAAC;QAC3Ba,QAAQ,EAAEb,QAAQ,CAAC,iBAAiB,CAAC;QACrCc,QAAQ,EAAE;MACZ,CAAC;MACDC,KAAK,EAAE;QACLN,IAAI,EAAE,kBAAkB;QACxBO,UAAU,EAAE;MACd;IACF;EACF,CAAC;EAED,MAAMC,WAAW,GAAGb,SAAS,CAACc,IAAyB;EACvD,MAAM,CAACC,QAAQ,CAAC,GAAGF,WAAW,CAACG,aAAa,CAAC,MAAM,EAAE,CAACZ,YAAY,CAAC,CAAC;EACpEF,MAAM,GAAGa,QAAQ,CAACE,GAAG,CAAC,kBAAkB,CAA+B;EACvEjB,SAAS,CAACkB,OAAO,CAAC,iBAAiB,EAAEhB,MAAM,CAAC;EAC5C,OAAOA,MAAM;AACf;AAEA,OAAO,SAASiB,4BAA4B,CAACpB,KAAY,EAAEqB,IAAY,EAAE;EACvE,MAAMpB,SAAS,GAAGD,KAAK,CAACE,gBAAgB,EAAE;EAC1C,MAAMC,MAAM,GAAGJ,qBAAqB,CAACE,SAAS,CAAC;EAC/C,MAAMqB,WAA2B,GAAG;IAClChB,IAAI,EAAE,gBAAgB;IACtBiB,GAAG,EAAE1B,QAAQ,CAACwB,IAAI,CAAC;IACnBG,KAAK,EAAE3B,QAAQ,CAACwB,IAAI,CAAC;IACrBV,QAAQ,EAAE,KAAK;IACfc,SAAS,EAAE;EACb,CAAC;EAED,MAAM,CAACT,QAAQ,CAAC,GAAGb,MAAM,CAACc,aAAa,CAAC,YAAY,EAAE,CAACK,WAAW,CAAC,CAAC;EACpExB,SAAS,CAACkB,QAAQ,CAACE,GAAG,CAAC,OAAO,CAAC,CAAyB;AAC1D"}